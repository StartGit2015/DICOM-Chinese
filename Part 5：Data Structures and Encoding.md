# 第1节 适用范围和领域
此章是DICOM标准的第5部分，出版目的是为了促进医疗环境下数字成像计算机系统间的信息交换。这种信息交换可以增强影像诊断和一些潜在的临床应用。DICOM标准为实现这种信息交换提供了协议和数据。  
   
 该章主要讲述数据结构和数据集的编码。当应用实体通过网络通信时，会有一个数据集包含在DICOM消息中来传递一些通过网络管理的现实世界对像的一些信息。在这个标准的其它应用中，数据集可能有不同的上下文，例如：在媒体交换中，数据集会转化成文件内容的结构。

 该部分DICOM标准主要阐述：

    a)值的编码
    b)数据集的结构和使用
    c)数据元素的使用及其与其它元素的关系
    d)嵌套数据集的组成及使用
    e)包含像素的数据什么样组成及使用
    f)如何唯一识别信息
    g)标准DICOM传输语法的详述

    该部分DICOM标准未讲述的有：

    a)消息的结构和语法(第7章详述)
    b)命令集的结构及使用(第7章详述)
    c)应用服务的详述及分类(第3、4章详述)
    d)怎把数据集和网络通信、媒体存储及其它应用关联起来  
    
# 第2节 引用标准

# 第3节 术语
标准中定义了以下术语：

# 3.1 参考模型
标准的这部分引用了ISO 7498中的以下项目:

    a)应用实体
    b)开放式系统互联协议

# 3.2 关联控制服务元素
标准的这部分引用了ISO 8649中的以下项目:

    a)关联

# 3.3 描述服务
标准的这部分引用了ISO 8822中的以下项目:

    a)表达上下文
    b)表达数据元素(pdv)
    c)传输语法
    d)传输语法名

# 3.4 对像识别
标准的这部分引用了ISO 8824中的以下项目:

    a)开放式互联系统对像识别

# 3.5 DICOM介绍和概述
标准的这部分引用了第1章中的以下项目:

    a)属性
    b)命令元素
    c)数据字典

# 3.6 DICOM一致性
标准的这部分引用了第2章中的以下项目:

    a)一致性声明
# 3.7 DICOM信息对像
标准的这部分引用了第3章中的以下项目:

    a)属性标签
    b)信息实体    
    c)信息对像定义(IOD)
    d)多帧图像
# 3.8 DICOM服务类详述
标准的这部分引用了第4章中的以下项目:

    a)服务对像对类
# 3.9 DICOM支持信息交换的网络通信
标准的这部分引用了第8章中的以下项目:

    a)DICOM上层协议服务
# 3.10 DICOM数据结构及编码
以下是此标准的常用定义：

**标准偏移表**：一个指向多帧压缩图像每一帧的指针表。

**高字节序**：一种高字节在前低字节在后的字节编码格式。

**字符集**：一些可以完成指定目标并且与编码无关的字符的有限集合（也称字库）。

**数据元素**：数据字典中定义的一个数据单元。一个编码过的信息对像定义属性由3部分组成：数据元素标签、值长度、值域。对一些特殊的传输语法来说，数据元素还包含值描述域。

**数据元素标签**：由一对有序的数字对组成的数据元素的唯一标识符。

**数据元素类型**：用来表明信息对像或服务对像对类的属性是强制的、条件强制或可选的。也可以转化为数据集中的一个数据元素是强制的、条件强制或可选的。

**数据集**：交换信息是由一组有组织的与信息对像有直接或间接关系的属性值组成的。在数据集的每一个属性的值都表示为一个数据元素。把一系列数据元素按其标签数字值按递增模式进行排序的过程就是对现实世界对像属性值的编码。

**确定项**：当一个数据元素的值是一组明确规范的标准值，并且这些值可被使用者扩展时就称作确定项。

**元素序号**：组成数据元素标签的有序数字对的第二个值。

**枚举值**：当一个数据元素的值是一组明确规范的标准值，并且这些值可被使用者扩展时这个数据元素的值就是一个枚举值。

**组号**：组成数据元素标签的有序数字对的第一个值。

**项**：数据元素值的一个组成部分是具有值表示法为项的序列。一个项包含一个数据集。

**项界定数据元素**：用来在一个拥有许多项的序列中来标明一个未定义长度的项的末尾，这个元素同时也是一个未定义长度的项的最后一个元素。

**低字节序**：在多字节二进制数据编码时把最低有效位放在第一位，其余字节按有效位递增编码的方式。

**嵌套数据集**：一个数据集的数据元素中包含另一个数据集，数据集可以递归包含。只有数据元素的值表示法为项的序列时它才可以包含数据集。

**像素单元**：一个像素采样值的容器，它可以包含未使用位或数据并非像素采样值的位（例如：覆盖面），像素单元的大小由（0028，0100）位分配值数据元素来确定。

**像素数据**：具有位深的图形数据编码在像素数据元素里，并且值表示方法为OW/OB。附加描述符元素通常用来表示像素数据元素的内容。

**像素采样值**：和单个像素相关的数值。一个像素通常由一个或多个像素采样值组成。（彩色图像）

**私有数据元素**：由使用方定义的附加数据元素，来传递一些不包含在标准数据元素中的信息。私有数据元素的组号都是奇数。

**重复组**：组号在一个特定区间中的数据元素它们具有相同的元素序号，在各自的组内有相同的含义(相同的数据类型，数据多重性，数据表示方法)。重复组只存在于曲线和覆盖层（分别对应（50xx,eeee）,（60xx,eeee））及一些3.0版本标准以前的残留信息。

**作废数据元素**：从3.0版本开始不支持的数据元素，应用可以继续使用这些作废元素来达到兼容3.0以前版本的目的，但是这些元素对当前版本来说不是必有的。

**序列界定项**：用来界定未定义数据长度的序列的项，此项是序列的最后一个项。

**序列（值表示法SQ）**：包含数据集的数据元素的值表示法，序列是允许嵌套的。

**标准数据元素**：DICOM标准中定义的数据元素，并且是出现在第6章数据字典中的。

**传输语法（标准和私有）**：一组允许应用实体间进行模糊协商他们所技能的编码方法（例如:数据元素结构，字节序，压缩模式）的编码规则，这样才能达到允许应用实体间的通信。

**未定义长度**：一种说明数据元素值长度或项长度未知的方法（值表示法为：SQ,OW,OB）。未定义长度的数据元素和项分别是以数据元素界定项和序列界定项来界定的。

**唯一标识符（UID）**：一个用来唯一识别多种项的的字符串；来保证在多个国家、城市、供应商及设备间的唯一性。

**值**：值域的组成部分，一个值域可以由多个这种部件组成。

**值域**：数据元素中包含数值的区域。

**值长度**：数据元素中包含值域长度的区域。

**数据多重性**：表明数据元素的值域中包含的数值的数量。

**值表示法**：表明数据元素的值域中数据的类型和格式。

**值表示法域**:当一个数据元素的编码结构为显式时，这种值表示法存储的区域。

# 3.11 字符处理定义
标准的这一部分引用了ISO/IEC 2022:1994中的以下项：

    a) 编码字符集
    b) 代码扩充
    c) 控制字符
    d) 指派
    e) 转义序列
    f) 图形字符
    g) 调用
    
# 第4节 符号及缩写

# 第5章 约定

# 第6章 值的编码
数据集是由经过编码的现世界对象模型的信息对象定义里的属性数值组成的.这些属性的详细内容及语法都说述在信息对象定义中（PS3.3）.些章主要详述这些值的大体数据类型取值范围和编码方法。数据集的结构即这些值是都包含哪些数据元素将第7章讲述。

贯穿这章及DICOM标准的其它章节，都是使用标签来标识具体的属性及它们对应的数据元素。

# 6.1 支持的字符集
值可以是由图形和控制符组成的文本或字符串，图形字符集，独立于其编码，被称为一个字符库，鉴于使用DICOM协议进行数据交互的应用所使用的自然语言的语境不同，这里可能会多种不同的字符集。DICOM支持的字符集都定义在ISO 8859中。

此外对于日语，DICOM支持以下字符集：
JIS X 0201-1976 信息交换码

JIS X 0208-1990 用于信息交换的日本图形字符集的代码

JIS X 0212-1990 用于信息交换的补充日本图形字符集的代码


#6.2 已编码的字符值的表示法
按照些节所引用的ISO标准中的定义，出现在这节中的字符编码后都是以字节型数值表示，其格式为2位10进制数分别表示行、列。

这也就是说他的数值可以这样计算（列*16）+行，例如：01/11对应数值为27（1BH）；

**注：**

用2位16进制数的记号法来表示字符的编码将会贯穿此标准的剩余部分；行、列记号法仅使用在6.1章节中用来简化在合适的ISO标准间的穿插引用。

字节编码空间被按值域分为4部分：

CL bytes from 00/00 to 01/15

GL bytes from 02/00 to 07/15

CR bytes from 08/00 to 09/15

GR bytes from 10/00 to 15/15

**注：**

ISO 8559不区分码元（如：G0）和其引用表的区位（如：GL）。"G0"这一个词即表示码元，又表示编码表中的区位。ISO/IEC 2022中对码元(G0, G1, G2, 和 G3)和其引用表的区位(GL 或 GR)做出了明确的区分，该标准使用ISO/IEC 2022的语法。

表位CL应该调用控制字符集C0，图像字符集G0和G1分别对应表位G1和GL。DICOM中仅使用C0中的部分控制符和C1中的一些字符。

#6.1.2 图像字符

一个字符库或字符集，就是一系列独立于编码方式的图形字符的集合，DICOM中所有涉及到的字符库都是由在ISO 2375中的注册号及'ISO-IR xxx'这种格式构成。

许多标准包括ISO 8859（1-9部分）都详述了编码字符集，编码字符集和图形字符集都与字符集中的每一个字符和其对应的编码表示有着一一对应的关系。

#6.1.2.1 默认字符库
DICOM中字符串的默认库为国际版ISO 646:1990 (ISO-IR 6)的基准G0集，详见附录E有一份DICOM默认字符库及其编码的表格。

**注：**

基准字符集GO和ISO 8859中的普通字符集是相同的。

#6.1.2.2 默认字符库的扩充及替换
DICOM应用实体可以通过使用特殊字符集（0008，0005）这一属性来扩充和替换默认字符集。

**注：**

特殊字符集使用ISO-IR 6的子集来进行编码。参照表6.2.1中对值表示法"CS"的定义。

对于值表示法为"SH","LO","ST","LT","PN","UT"的数据元素其字符库可能为扩充的或替换的（详见6.2）。如果这种扩充或远的字符集被使用了，则相应特殊字符集这一属性(0008,0005)应当被定义在常规服务对象对模型中作为一个属性(参见 PS 3.3)并且要在一致性声明中作以阐明。PS3.2中也给出了一致性声明的参考。

**注：**

1. 在西部、东部及欧洲ENV 41 503 和 ENV 41 508中定义的首选字符集分别为：ISO-IR 100, ISO-IR 101, ISO-IR 144, ISO-IR 126见6.1.2.3节。
2. 信息对象定义使用不同的字符集不能依赖本身的词汇顺序或字串对比来表示字符串。这些操作只能使用一个给定的字符库不能交叉字符库的界限。
#6.1.2.3 字符库的编码
使用值表示法SH, LO, ST, LT,PN 和 UT和PS3.3中一个单字节码就可以替代7位默认字符库。

**注：**
这种替换字符库不适合于文本值表示法（AE和CS）.

替换字符库应该出现在特殊字符集属性（0008，0005）值的第一值，特殊字符集的详细定义参见PS3.3。

**注：**

1. 编码表分为只支持94个字符集的GL区(位组合 从 02/01 到 07/14)加上02/00区间和支持96和94字符集的GR区间(位组合从 10/01 到 15/14 或从 10/00 到 15/15)。默认字符集(ISO-IR 6)通常从GL区调用。
2. ISO 8859中定义的所有字符集都包含(ISO-IR 6)。这一字符集将常被在编码表的GL区中调用，它和ASCII (ANSI X3.4:1986)是相同的。然而各种各样的扩充及替换都会被映射到编码表中的GL区。
3. 8位码表JIS X 0201	包含了ISO-IR 14（罗马数字字符）作为G0码元和ISO-IR 13（片假名注意字符）作为G1表码元。ISO-IR 14和ISO-IR 6是相同的，除了位组合05/12表示"¥"(日元符号)和位组合07/14表示上划线。

在码表中的GL区调用单字节字符库的2个字符码02/00和 05/12在DICOM标准中有很特殊意义。空格字符是由位组合02/00表示的，可以用来填充数据元素表示法为字符串的值。在表ISO-IR 6中的位组合05/12表示的图像字符"\"（反斜杠），只能被使用在值表示法为UT, ST 和 LT的字符串中。然而位组合05/12被用作多值数据元素的分隔符（详见6.4）。

**注：** 

当特殊字符集(0008,0005)的值即不是“ISO_IR 13” 也不是 “ISO 2022 IR 13”，图形字符用ISO-IR 14表中的位组合05/12表示"¥"（日元符号）。

删除字符（位组合07/15）不应在DICOM字符串中使用。

设定在特殊字符集属性(0008,0005)的值中第一值的替换字符集（或默认字符集的第一位为空）在必要时也可以更深一步扩充为附加编码字符集。附加编码字符集及其扩充机制应当被声明在特殊字符集属性值的附加值域。如果特殊字符集属性只有一个值，那么DICOM 服务对象对实例仅支持一种单字节编码表并且没有扩充编码机制，DICOM服务对象对实例支持的扩充编码机制在ISO/IEC 2022:1994有详细说明。

**注：** 以下为考虑到对不支持字符集的处理

DICOM中应用实体之间并不协商字符集，它是由通用服务对象对模型中的附加属性值指明的，因此应用可以应对对它们来说不清楚的字符集，机器可以通过使用四个字符"\nnn"其中"nnn"为3个8进制数分别表示一个字节，来显示和打印这些不能识别的字符。

例如对于一个基于ASCII的机器例子如下：

字符串：Günther

编码后表示法：04/07 15/12 06/14 07/04 06/08 06/05 07/02

基于ASCII的机器：G\374nther

应用也可能会碰到一些没有办法显示或打印的字符。此时可以通过使用四个字符"\nnn"其中"nnn"为3个8进制数分别表示一个字节，来显示和打印这些不能识别的字符。

#6.1.2.4 扩充编码方法

对于值表示法为SH, LO, ST, LT,PN 或 UT的数据元素，默认字符集或字符集在特殊字符集属性(0008,0005)第一值中指定的，可以扩展使用定义在ISO/IEC 2022:1994中的扩充字符编码技术。

如果使用了这种扩充编码技术，那么相关的特殊字符集应该在常规服务对象对模型(PS 3.3)的特殊字符集(0008,0005)属性的第值中作以指明，并且要在一致性声明中做以陈述。

**注：** 

1. 特殊字符集属性(0008,0005)定义在PS 3.3
2. 支持日本汉字,平假名,片假名，韩语的字符集定义在PS3.3，定义汉语等多字节的字符集要等待适合的标准化组织考虑。

#6.1.2.5 扩充编码的使用

当特殊字符集属性(0008,0005)值是多值时DICOM就会使用扩充编码技术，在DICOM中使用扩充编码的方法在ISO/IEC2022:1994中有详细介绍，这种情况下将引入以下假设及限定：

#6.1.2.5.1 假设初始状态

- G0码元和G1码元（8位）通常分别被从编码表中的GL和GR区调用，会对这些码元会直接调用指定的字符集，码元G2和G3不使用。
- 首选控制字符集被指定为从编码表的GL区调用的G0码元。G1码元不使用。

#6.1.2.5.2 扩充编码的限制
- G0和G1码元通常具有位移状态和锁定位位移（SI,SO），在这里不需要和也不就使用
- G2和G3这些未使用的码元，单移位(SS2 和 SS3)也不能使用
- 只有在PS 3.3中说明过的转义序列才可以被用来激活码元

#6.1.2.5.3 要求

特殊字符集属性(0008,0005)值1中指定的字符集，或者当特殊字符集属性(0008,0005)值1缺省时的默认字符集，可以出现在文本型数据元素的值的开始以及每一行(如, CR 和/或 LF之后)或每一页的开始(如, FF之后).

如果在一个文本属性值的值域中出现了即不是在特殊字符集属性(0008,0005)值第一值指定的字符集中的字符，或者当特殊字符集属性(0008,0005)值1缺省时的默认字符集时，此时在第一值中指定的字符集或者默认字符集在以下情况可用：

- 行结尾前(如, CR 和/或 LF之前)
- 页结尾前(如, FF之前)
- 数据元素值结尾前（如，在用来分隔多值文本型数据元素值的05/12之前，这里的05/12对应默认字符集IR-6中的"\"(反斜杠)或IR-14字符集中的“¥”（人民币））
- 在分隔值表示法为PN的名称组件或名称组件组数据元素值之前

如果在文本型数据元素值中使用了和特殊字符集属性(0008,0005)值1中指定的字符集，或者当特殊字符集属性(0008,0005)值1缺省时的默认字符不同的字符集时，此字符集中的转义序列必须按以下情形来插入：

- 在一行首次使用该字符集之前
- 在一页首次使用该字符集之前
- 在数据元素值中首次使用该字符集之前
- 在值表示法为PN的名称组件或名称组件组数据元素值第一次使用该字符集之前

**注：**

这些要求允许应用跳过文本型数据元素中的行，值 ，组件，和使用指定字符集开始一新行而不用去跟踪路过的文本中的字符集。在RFCs中类似的限制用来描述在网络中多字节字符集的使用。在一行或一个值或一个没有使用扩充编码的组件中不需要使用转义字符串来切换至设定的字符集或默认字符集。当特殊字符集第一值的字符集或默认字符集中仅定义了G0码元或G0码元是可用的，此时就需要一个或非来做转义开关。

#6.1.2.5.4 应用级别和初始化指示

1. 特殊字符集属性(0008,0005)值缺省
	
	7位码

	应用级别：ISO 2022 Level 1 - 初级 7位码 (编码级别 标志 1)

	初始化指示：ISO-IR 6 (ASCII) as G0

	不能使用扩充编码
2. 特殊字符集属性(0008,0005)单值

	8位码

	应用级别：ISO 2022 Level 1 - 初级 8位码 (编码级别 标志 11)

	初始化指示：ISO 8859中定义的字符集之一，或由特殊字符集属性(0008,0005)值1指定的JIS X 0201中的8位编码表，如G0和G1

	不使用扩充编码
3. 特殊字符集属性(0008,0005)值多值

	8位码

	应用级别：ISO 2022 Level 4 重新设计的图形字符集在一种编码中（编码级别 标志 14）

	初始化指示：ISO 8859中定义的字符集之一，或由特殊字符集属性(0008,0005)值1指定的JIS X 0201中的8位编码表，如G0和G1。如果特殊字符集属性(0008,0005)值1缺省，ISO-IR 6 (ASCII)被假设为G0，并且G1为未定义的。
	
	所有出现在多值属性特殊字符集(0008,0005)中的字符集，都可以加入到扩充编码中。

#6.1.3 控制字符

交互中的文本数据也许需要一种格式化的信息。控制字符就是用来指出一种格式，但是在DICOM中应尽量少的使用，因为有些设备会不正确的使用这些控制字符。ISO 646:1990 和 ISO 6429:1990中定义了控制字符，如下在DICOM中仅使用C0集中的4个控制字符用来对字符串数据进行编码。
![表6.1-1](https://raw.githubusercontent.com/mnhwa/DICOM-Chinese/master/Figure/Part 5/PS3.5_Table 6.1_1.jpg)

在文本字符串中以CR LF作为新行。

**注：**

一些机器（基于UNIX的机器）会把LF (00/10)当作新行。在这种情况下，把期望的DICOM格式为可以转化为相应机器正确的内部表示。
